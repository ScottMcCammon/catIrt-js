#!/usr/bin/env node
const createCatIrtLib = require('../dist/catirtlib');

createCatIrtLib().then(function(catirtlib) {
  const resp = [1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0]; 
  const params = [
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
      [1.55,-1.88,0.12],
      [3.02,-0.38,0.12],
      [1.9,-0.1,0.12],
      [2.06,0.41,0.12],
      [1.48,0.72,0.12],
  ];

  let maxHeap = 0;
  let i = 1;
  let u, res;
  while (true) {
    res = catirtlib.wleEst_brm_one(resp, params);

    // inspect heap
    if ((i % 10000) === 0) {
      u = process.memoryUsage();
      if (u.heapUsed > maxHeap) {
        maxHeap = u.heapUsed;
      }
      console.log(`iteration ${i}: maxHeap: ${Math.floor(maxHeap/1024)}K total: ${Math.floor(u.heapTotal/1024)}K used: ${Math.floor(u.heapUsed/1024)}K`);
    }

    i++;
  }
});
